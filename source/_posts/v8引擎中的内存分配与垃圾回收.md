---
title: v8引擎中的内存分配与垃圾回收
date: 2021-12-02 12:06:26
tags:
---

# 浏览器内核

先介绍一下浏览器内核，浏览器内核主要分为渲染引擎和JavaScript引擎，这边罗列了一些常见的浏览器的内核使用的引擎

|  浏览器   | 渲染引擎  | JavaScript引擎 |
|  ----  | ----  | ----  |
| Chrome  | Blink(13 年之前使用的是 Safari 的 Webkit, Blink 是谷歌与欧朋一起搞的) | V8 |
| Safari  | Webkit | JavaScriptCore |
| Firefox  | Gecko | SpiderMonkey--OdinMonkey |
| IE  | Trident | Chakra |

渲染引擎和 JS 引擎相互协作，打造出浏览器显示的页面，看下图：

![浏览器工作](https://static001.geekbang.org/infoq/1a/1a95c7604cfe213d01b9efe3d4a08a6c.webp)

简单看看就行，不重要，既然是讲垃圾回收( Garbage Collection 简称 GC )，那就要先了解一下 **内存**，计算机五大硬件之一存储器的核心之一，见下图：

![计算机构成](https://static001.geekbang.org/infoq/4e/4e6e4b43a4b6853fc0a6634d9bb5b847.png)

# 内存分配

## 栈

简单说，栈内存，小且存储连续，操作起来简单方便，一般由系统自动分配，自动回收，所以文章内所说的垃圾回收，都是基于堆内存。

## 堆

堆内存，大(相对栈来说)且不连续。

## V8 中内存分类

V8的垃圾回收策略主要是基于`分代收集理论`，其根据对象的存活时间将内存的垃圾回收进行不同的分代，然后对不同的分代采用不同的垃圾回收算法。

### 分代收集理论

分代收集理论，是基于程序运行对象存活数量和对象年龄之间关系的一套经验法则。

它建立在两个分代假说之上：

* **弱分代假说（Weak Generational Hypothesis）**：绝大多数对象都是朝生夕灭的。
* **强分代假说（Strong Generational Hypothesis）**：熬过越多次垃圾收集过程的对象就越难以消亡。  
	
用通俗的话总结：大部分污渍很容易擦干净，多次擦都没擦干净的无责越来越难擦干净。



# 参考文章

[一文搞懂V8引擎的垃圾回收](https://juejin.cn/post/6844904016325902344)  
[V8 引擎垃圾回收与内存分配](https://www.infoq.cn/article/ngttadzuoseeiurqgqni)  
[【JVM进阶之路】六：垃圾收集理论和算法](https://bbs.huaweicloud.com/blogs/detail/253291)