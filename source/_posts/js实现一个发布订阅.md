---
title: js实现一个发布订阅
date: 2020-05-28 19:14:44
tags: JS JS基础 面试题 进阶
---

## js设计模式之发布-订阅模式

发布-订阅模式又叫观察者模式，它用来定义一种一对多的依赖关系。当某个对象发生改变的时候，所有依赖于它的对象都将得到通知。在js中，通常用事件模型来代替传统的发布订阅模式（因为js没有类，可以直接传递函数）。



## 发布订阅模式的作用

  **第一点**广泛用于异步编程中，这是一种代替传统回调函数的手段。比如我们监听异步请求的success和error事件。当事件来临 的时候，发布一个状态，那么对此感兴趣的订阅者就会收到这个状态并执行相关操作。
  
  **第二点**在程序方面带来的好处是可以改变对象之间的硬编码的通知机制。一个对象不再显式地去调用另外一个对象的某个接口。发布订阅模式将两个对象松耦合地联系在一起，虽然不清除彼此细节，但并不影响彼此通信。无论发布者还是订阅者发生了变化，只要它们之间的约定没有变，就没有关系。
  

## 常见的订阅发布模式--DOM事件

window.addEventListener就是一个典型的例子。
```
  document.body.addEventListener('click', fn1);
  document.body.addEventListener('click', fn2);
  document.body.addEventListener('click', fn3);
```

用户可能会点击页面，但不知道什么时候点击。所以我们订阅body的click事件，当body被点击的时候，body节点便会向订阅者发布这个消息。

当然我们还可以随意移除订阅者，通过removeEventListener事件。

## 实现一个简单的发布订阅模式

除了内置的DOM事件，我们还会经常实现一些自定义的事件，这种依靠自定义事件完成的发布-订阅模式可以用于任何js的代码中。现在来实现一个简单的发布订阅模式。
